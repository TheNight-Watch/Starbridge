# ğŸ¥ æ˜Ÿæ¡¥å®æ—¶è§†é¢‘é€šä¿¡ç³»ç»Ÿæ“ä½œæŒ‡å—

## ğŸ“‹ ç³»ç»Ÿæ¦‚è§ˆ

### æ¶æ„ç»„ä»¶
- **å®¶é•¿ç«¯åº”ç”¨**: React + TypeScript Webåº”ç”¨
- **æ™ºèƒ½ç¡¬ä»¶ç«¯**: iOSè®¾å¤‡(iPhoneåŸå‹)
- **ä¿¡ä»¤æœåŠ¡å™¨**: Node.js WebSocketæœåŠ¡å™¨
- **æ•°æ®åç«¯**: Supabaseå®æ—¶æ•°æ®åº“

### æŠ€æœ¯æ ˆ
- **å‰ç«¯**: React, WebRTC, WebSocket
- **åç«¯**: Node.js, WebSocket (ws)
- **æ•°æ®åº“**: Supabase
- **é€šä¿¡åè®®**: WebRTC + WebSocketä¿¡ä»¤

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å¯åŠ¨ä¿¡ä»¤æœåŠ¡å™¨

```bash
# è¿›å…¥ä¿¡ä»¤æœåŠ¡å™¨ç›®å½•
cd social-compass-kids/signaling-server

# å®‰è£…ä¾èµ–
npm install

# å¯åŠ¨æœåŠ¡å™¨
npm start

# æˆ–è€…å¼€å‘æ¨¡å¼(è‡ªåŠ¨é‡å¯)
npm run dev
```

æœåŠ¡å™¨å¯åŠ¨åä¼šæ˜¾ç¤ºï¼š
```
ğŸš€ ä¿¡ä»¤æœåŠ¡å™¨å¯åŠ¨äºç«¯å£ 8080
âœ… WebRTCä¿¡ä»¤æœåŠ¡å™¨è¿è¡Œåœ¨ http://localhost:8080
ğŸ“Š å¥åº·æ£€æŸ¥: http://localhost:8080/health
ğŸ“ˆ ç»Ÿè®¡ä¿¡æ¯: http://localhost:8080/stats
```

### 2. å¯åŠ¨å®¶é•¿ç«¯åº”ç”¨

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
cd social-compass-kids

# å®‰è£…ä¾èµ–(å¦‚æœè¿˜æœªå®‰è£…)
npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
npm run dev
```

### 3. é…ç½®WebRTCè®¾ç½®

æ£€æŸ¥ `src/config/webrtcConfig.ts` æ–‡ä»¶ä¸­çš„é…ç½®ï¼š

```typescript
// å¼€å‘ç¯å¢ƒé…ç½®
export const developmentConfig: WebRTCConfig = {
  signalingServer: {
    url: 'ws://localhost:8080', // ç¡®ä¿ä¸ä¿¡ä»¤æœåŠ¡å™¨åœ°å€ä¸€è‡´
    reconnectInterval: 3000,
    maxReconnectAttempts: 5
  },
  // ... å…¶ä»–é…ç½®
};
```

---

## ğŸ”§ ä½¿ç”¨è¯´æ˜

### å®¶é•¿ç«¯æ“ä½œæ­¥éª¤

1. **æ‰“å¼€å®‰å…¨é¡µé¢**
   - åœ¨åº”ç”¨ä¸­å¯¼èˆªåˆ°"å®‰å…¨"é¡µé¢
   - æ‰¾åˆ°å®æ—¶è§†é¢‘ç›‘æ§åŒºåŸŸ

2. **å¯åŠ¨è§†é¢‘è¿æ¥**
   - ç‚¹å‡»"æŸ¥çœ‹å®æ—¶è§†é¢‘"æŒ‰é’®
   - ç³»ç»Ÿä¼šè‡ªåŠ¨è¿æ¥åˆ°æ™ºèƒ½ç¡¬ä»¶è®¾å¤‡

3. **è¿æ¥çŠ¶æ€æŒ‡ç¤º**
   - ğŸŸ¡ **è¿æ¥ä¸­**: æ­£åœ¨å»ºç«‹è¿æ¥
   - ğŸŸ¢ **å®æ—¶è¿æ¥**: è¿æ¥æˆåŠŸï¼Œå¯ä»¥æŸ¥çœ‹è§†é¢‘
   - ğŸ”´ **è¿æ¥å¤±è´¥**: è¿æ¥å¤±è´¥ï¼Œå¯æ‰‹åŠ¨é‡è¯•

4. **è§†é¢‘æ§åˆ¶åŠŸèƒ½**
   - ğŸ“¹ **è§†é¢‘å¼€å…³**: æš‚åœ/æ¢å¤è§†é¢‘æ˜¾ç¤º
   - ğŸ”Š **éŸ³é¢‘å¼€å…³**: é™éŸ³/å¼€å¯éŸ³é¢‘
   - ğŸ”„ **é‡æ–°è¿æ¥**: æ‰‹åŠ¨é‡è¯•è¿æ¥
   - â›¶ **å…¨å±æ¨¡å¼**: åˆ‡æ¢å…¨å±æ˜¾ç¤º

### æ™ºèƒ½ç¡¬ä»¶ç«¯(iPhone)æ“ä½œ

> æ³¨æ„: æ™ºèƒ½ç¡¬ä»¶ç«¯çš„WebRTCåŠŸèƒ½éœ€è¦åœ¨iOSåº”ç”¨ä¸­å®ç°ã€‚ä»¥ä¸‹æ˜¯éœ€è¦å®ç°çš„åŠŸèƒ½ï¼š

1. **è®¾å¤‡æ³¨å†Œ**
   ```swift
   // è¿æ¥åˆ°ä¿¡ä»¤æœåŠ¡å™¨å¹¶æ³¨å†Œä¸ºç¡¬ä»¶è®¾å¤‡
   websocket.send(JSON.stringify({
     type: 'register_device',
     clientType: 'hardware_device',
     deviceId: 'smart_device_vision_001'
   }))
   ```

2. **è§†é¢‘æµæ¨é€**
   - ä½¿ç”¨AVFoundationè·å–æ‘„åƒå¤´ç”»é¢
   - é€šè¿‡WebRTCå‘é€è§†é¢‘æµåˆ°å®¶é•¿ç«¯

3. **å“åº”è¿æ¥è¯·æ±‚**
   - ç›‘å¬æ¥è‡ªå®¶é•¿ç«¯çš„è¿æ¥è¯·æ±‚
   - å»ºç«‹WebRTC peer connection

---

## ğŸ” æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. è¿æ¥å¤±è´¥
**é—®é¢˜**: æ˜¾ç¤º"è¿æ¥å¤±è´¥"æˆ–"è®¾å¤‡ä¸åœ¨çº¿"

**è§£å†³æ–¹æ¡ˆ**:
- ç¡®è®¤ä¿¡ä»¤æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ (`http://localhost:8080/health`)
- æ£€æŸ¥æ™ºèƒ½ç¡¬ä»¶è®¾å¤‡æ˜¯å¦å·²å¯åŠ¨å¹¶è¿æ¥åˆ°åŒä¸€ç½‘ç»œ
- æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°å’Œä¿¡ä»¤æœåŠ¡å™¨æ—¥å¿—

#### 2. è§†é¢‘æ— æ³•æ˜¾ç¤º
**é—®é¢˜**: è¿æ¥æˆåŠŸä½†çœ‹ä¸åˆ°è§†é¢‘

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥æ™ºèƒ½ç¡¬ä»¶ç«¯æ˜¯å¦æ­£ç¡®æ¨é€è§†é¢‘æµ
- ç¡®è®¤WebRTCè¿æ¥çŠ¶æ€ä¸º"connected"
- æ£€æŸ¥æµè§ˆå™¨çš„åª’ä½“æƒé™è®¾ç½®

#### 3. éŸ³é¢‘é—®é¢˜
**é—®é¢˜**: è§†é¢‘æ­£å¸¸ä½†å¬ä¸åˆ°å£°éŸ³

**è§£å†³æ–¹æ¡ˆ**:
- ç‚¹å‡»éŸ³é¢‘æŒ‰é’®å–æ¶ˆé™éŸ³
- æ£€æŸ¥æµè§ˆå™¨éŸ³é¢‘æƒé™
- ç¡®è®¤æ™ºèƒ½ç¡¬ä»¶ç«¯å¯ç”¨äº†éŸ³é¢‘ä¼ è¾“

#### 4. ç½‘ç»œè¿æ¥ä¸ç¨³å®š
**é—®é¢˜**: é¢‘ç¹æ–­çº¿é‡è¿

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ç½‘ç»œç¨³å®šæ€§
- è°ƒæ•´WebRTCé…ç½®ä¸­çš„é‡è¿å‚æ•°
- è€ƒè™‘ä½¿ç”¨TURNæœåŠ¡å™¨æ”¹å–„NATç©¿é€

### æ—¥å¿—æŸ¥çœ‹

#### æµè§ˆå™¨æ§åˆ¶å°
æ‰“å¼€å¼€å‘è€…å·¥å…·æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ï¼š
```
F12 -> Consoleé€‰é¡¹å¡
```

å…³é”®æ—¥å¿—ä¿¡æ¯ï¼š
- `WebRTCæœåŠ¡åˆå§‹åŒ–`
- `ä¿¡ä»¤æœåŠ¡å™¨è¿æ¥æˆåŠŸ`
- `æ”¶åˆ°è¿œç¨‹è§†é¢‘æµ`
- `WebRTCè¿æ¥çŠ¶æ€å˜åŒ–`

#### ä¿¡ä»¤æœåŠ¡å™¨æ—¥å¿—
```bash
# æŸ¥çœ‹æœåŠ¡å™¨å®æ—¶æ—¥å¿—
tail -f signaling-server.log

# æˆ–è€…åœ¨å¼€å‘æ¨¡å¼ä¸‹ç›´æ¥æŸ¥çœ‹æ§åˆ¶å°è¾“å‡º
```

å…³é”®æ—¥å¿—ä¿¡æ¯ï¼š
- `æ–°çš„WebSocketè¿æ¥å»ºç«‹`
- `è®¾å¤‡æ³¨å†Œ: parent_app`
- `å®¶é•¿ç«¯è¿æ¥åˆ°è®¾å¤‡`

---

## ğŸ“Š ç›‘æ§å’Œç»Ÿè®¡

### è¿æ¥ç»Ÿè®¡ä¿¡æ¯

åœ¨è§†é¢‘ç•Œé¢å¯ä»¥æŸ¥çœ‹å®æ—¶ç»Ÿè®¡ï¼š
- **å»¶è¿Ÿ**: ç½‘ç»œå¾€è¿”æ—¶é—´(RTT)
- **æ•°æ®æ¥æ”¶é‡**: å·²æ¥æ”¶çš„è§†é¢‘æ•°æ®é‡
- **ä¸¢åŒ…æ•°**: ç½‘ç»œä¸¢åŒ…ç»Ÿè®¡

### æœåŠ¡å™¨ç»Ÿè®¡

è®¿é—® `http://localhost:8080/stats` æŸ¥çœ‹ï¼š
```json
{
  "clients": 2,
  "rooms": [
    {
      "deviceId": "smart_device_vision_001",
      "parentClients": 1,
      "createdAt": "2024-01-20T10:30:00.000Z"
    }
  ]
}
```

---

## ğŸ›  å¼€å‘å’Œè°ƒè¯•

### æœ¬åœ°å¼€å‘ç¯å¢ƒ

1. **å¯åŠ¨å®Œæ•´å¼€å‘ç¯å¢ƒ**
```bash
# ç»ˆç«¯1: å¯åŠ¨ä¿¡ä»¤æœåŠ¡å™¨
cd signaling-server && npm run dev

# ç»ˆç«¯2: å¯åŠ¨å‰ç«¯åº”ç”¨
cd .. && npm run dev
```

2. **æ¨¡æ‹Ÿè®¾å¤‡è¿æ¥**
   - å¯ä»¥ä½¿ç”¨WebSocketæµ‹è¯•å·¥å…·æ¨¡æ‹Ÿç¡¬ä»¶è®¾å¤‡è¿æ¥
   - æˆ–è€…åˆ›å»ºç®€å•çš„æµ‹è¯•é¡µé¢

### æµ‹è¯•å·¥å…·

#### WebSocketæµ‹è¯•
ä½¿ç”¨æµè§ˆå™¨æ‰©å±•æˆ–åœ¨çº¿å·¥å…·æµ‹è¯•WebSocketè¿æ¥ï¼š
```
URL: ws://localhost:8080
å‘é€æ¶ˆæ¯: {"type":"register_device","clientType":"hardware_device","deviceId":"test_device"}
```

#### WebRTCæµ‹è¯•
åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ `chrome://webrtc-internals/` æŸ¥çœ‹WebRTCè¿æ¥è¯¦æƒ…

---

## ğŸ”’ å®‰å…¨é…ç½®

### ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

1. **HTTPS/WSS**
   - ç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨HTTPSå’ŒWSS
   - é…ç½®SSLè¯ä¹¦

2. **é˜²ç«å¢™è®¾ç½®**
   - å¼€æ”¾ä¿¡ä»¤æœåŠ¡å™¨ç«¯å£(é»˜è®¤8080)
   - é…ç½®STUN/TURNæœåŠ¡å™¨

3. **è®¤è¯å’Œæˆæƒ**
   - æ·»åŠ è®¾å¤‡è®¤è¯æœºåˆ¶
   - å®ç°ç”¨æˆ·æƒé™æ§åˆ¶

### ç½‘ç»œé…ç½®

#### STUN/TURNæœåŠ¡å™¨
```typescript
// ç”Ÿäº§ç¯å¢ƒé…ç½®ç¤ºä¾‹
iceServers: [
  { urls: 'stun:stun.l.google.com:19302' },
  {
    urls: 'turn:your-turn-server.com:3478',
    username: 'your-username',
    credential: 'your-credential'
  }
]
```

---

## ğŸ“± iOSè®¾å¤‡é›†æˆæŒ‡å—

### æ‰€éœ€å®ç°çš„åŠŸèƒ½

1. **WebRTCé›†æˆ**
```swift
import WebRTC

class HardwareVideoStreaming {
    private var peerConnection: RTCPeerConnection?
    private var localVideoTrack: RTCVideoTrack?
    
    func startStreaming() {
        // åˆå§‹åŒ–æ‘„åƒå¤´
        // åˆ›å»ºWebRTCè¿æ¥
        // å‘é€è§†é¢‘æµ
    }
}
```

2. **ä¿¡ä»¤é€šä¿¡**
```swift
import Starscream

class SignalingClient {
    private var socket: WebSocket?
    
    func connect() {
        socket = WebSocket(url: URL(string: "ws://localhost:8080")!)
        socket?.connect()
    }
    
    func registerDevice() {
        let message = [
            "type": "register_device",
            "clientType": "hardware_device",
            "deviceId": "smart_device_vision_001"
        ]
        socket?.write(string: JSONSerialization.jsonString(message))
    }
}
```

---

## ğŸ†˜ æ”¯æŒå’Œå¸®åŠ©

### å¸¸ç”¨å‘½ä»¤

```bash
# æ£€æŸ¥ä¿¡ä»¤æœåŠ¡å™¨çŠ¶æ€
curl http://localhost:8080/health

# æŸ¥çœ‹è¿æ¥ç»Ÿè®¡
curl http://localhost:8080/stats

# é‡å¯ä¿¡ä»¤æœåŠ¡å™¨
pm2 restart signaling-server

# æŸ¥çœ‹åº”ç”¨æ—¥å¿—
npm run dev -- --verbose
```

### è”ç³»æ”¯æŒ

å¦‚æœé‡åˆ°æŠ€æœ¯é—®é¢˜ï¼Œè¯·æä¾›ï¼š
1. é”™è¯¯æ—¥å¿—(æµè§ˆå™¨æ§åˆ¶å°å’ŒæœåŠ¡å™¨æ—¥å¿—)
2. ç½‘ç»œç¯å¢ƒä¿¡æ¯
3. è®¾å¤‡å‹å·å’Œæ“ä½œç³»ç»Ÿç‰ˆæœ¬
4. å¤ç°æ­¥éª¤æè¿°

---

## ğŸ”„ ç‰ˆæœ¬æ›´æ–°

### å½“å‰ç‰ˆæœ¬: v1.0.0

**æ–°åŠŸèƒ½**:
- âœ… WebRTCå®æ—¶è§†é¢‘ä¼ è¾“
- âœ… è‡ªåŠ¨é‡è¿æœºåˆ¶
- âœ… è¿æ¥çŠ¶æ€ç›‘æ§
- âœ… å®æ—¶ç»Ÿè®¡ä¿¡æ¯
- âœ… å…¨å±æ¨¡å¼æ”¯æŒ

**è®¡åˆ’åŠŸèƒ½**:
- ğŸ”² å½•åˆ¶åŠŸèƒ½
- ğŸ”² å¤šè®¾å¤‡è¿æ¥
- ğŸ”² è§†é¢‘è´¨é‡è‡ªé€‚åº”
- ğŸ”² ç§»åŠ¨ç«¯ä¼˜åŒ–

---

è¿™ä¸ªç³»ç»Ÿç°åœ¨å·²ç»å…·å¤‡äº†å®Œæ•´çš„å®æ—¶è§†é¢‘é€šä¿¡èƒ½åŠ›ï¼Œå¯ä»¥æ”¯æŒå®¶é•¿ç«¯å’Œæ™ºèƒ½ç¡¬ä»¶è®¾å¤‡ä¹‹é—´çš„å®æ—¶è§†é¢‘ç›‘æ§ã€‚é€šè¿‡WebRTCæŠ€æœ¯ç¡®ä¿äº†ä½å»¶è¿Ÿçš„è§†é¢‘ä¼ è¾“ï¼Œéå¸¸é€‚åˆå®æ—¶ç›‘æŠ¤åœºæ™¯ã€‚ 